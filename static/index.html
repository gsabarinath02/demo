<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional AI-powered medical documentation system for clinicians and nurses.">
    <title>MedDoc Dashboard - Professional Edition</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
    <!-- Fixed Sidebar -->
    <aside class="sidebar">
        <div class="brand">
            <div class="brand-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path
                        d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                </svg>
            </div>
            <span class="brand-name">MedDoc AI</span>
        </div>

        <nav class="nav-list">
            <div class="nav-item">
                <a href="#" class="nav-link active" data-section="analysis">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9 22 9 12 15 12 15 22" />
                    </svg>
                    <span>Dashboard</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="tasks">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="3" rx="2" />
                        <path d="m9 12 2 2 4-4" />
                    </svg>
                    <span>Nurse Tasks</span>
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" data-section="records">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1-2.5-2.5Z" />
                        <path d="M8 7h6" />
                        <path d="M8 11h8" />
                    </svg>
                    <span>Medical Records</span>
                </a>
            </div>
        </nav>

        <div style="margin-top: auto; padding: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <div
                    style="width: 32px; height: 32px; border-radius: 50%; background: #475569; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 0.8rem;">
                    SN</div>
                <div style="color: white; font-size: 0.85rem;">
                    <p style="font-weight: 600;">Staff Nurse</p>
                    <p style="color: #64748b; font-size: 0.75rem;">Ward A-202</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Wrapper -->
    <div class="main-wrapper">
        <!-- Top Sticky Bar -->
        <header class="top-bar">
            <div>
                <h1 class="page-title">Patient Consultation Analysis</h1>
                <p class="page-subtitle" id="consultation-status">Ready to process new consultation audio</p>
            </div>
            <div class="status-pill" id="status-badge">
                <div class="status-indicator"></div>
                <span>System Online</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="content-area">

            <!-- SECTION: ANALYSIS (DASHBOARD) -->
            <div id="section-analysis" class="section-content active">
                <div class="dashboard-grid">

                    <!-- Top Actions Bar -->
                    <div class="col-12">
                        <div class="card" style="margin-bottom: 0;">
                            <div class="nav-tabs">
                                <button class="tab-pill active" data-tab="url">Enter YouTube URL</button>
                                <button class="tab-pill" data-tab="upload">Upload Consultation Audio</button>
                                <button class="tab-pill" data-tab="record">Record Audio</button>
                            </div>

                            <div class="input-content active" id="tab-url">
                                <div class="input-group">
                                    <input type="text" id="url-input" class="professional-input"
                                        placeholder="https://www.youtube.com/watch?v=...">
                                    <button class="btn-clinical" id="process-url-btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 2v4" />
                                            <path d="m16.2 7.8 2.9-2.9" />
                                            <path d="M18 12h4" />
                                            <path d="m16.2 16.2 2.9 2.9" />
                                            <path d="M12 18v4" />
                                            <path d="m4.9 19.1 2.9-2.9" />
                                            <path d="M2 12h4" />
                                            <path d="m4.9 4.9 2.9 2.9" />
                                        </svg>
                                        Run Analysis
                                    </button>
                                </div>
                            </div>

                            <div class="input-content" id="tab-upload">
                                <div class="clinical-drop" id="drop-zone">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" style="color: var(--primary); margin-bottom: 1rem;">
                                        <path d="M12 2v10" />
                                        <path d="m16 8-4 4-4-4" />
                                        <path d="M22 12a10 10 0 0 1-10 10" />
                                        <path d="M22 12a10 10 0 1 1-20 0" />
                                    </svg>
                                    <p style="font-weight: 600;">Drag and drop consultation audio</p>
                                    <p style="color: var(--text-muted); font-size: 0.85rem;">MP3, WAV, WEBM or OGG (Max
                                        25MB)</p>
                                    <input type="file" id="file-input" style="display: none;" accept="audio/*">
                                </div>
                                <div id="selected-file" class="card"
                                    style="display: none; margin-top: 1rem; padding: 0.75rem; background: var(--bg-main);">
                                    <span id="file-name" style="font-weight: 600;"></span>
                                    <button id="process-file-btn" class="btn-clinical" style="float: right;">Upload &
                                        Analyze</button>
                                </div>
                            </div>

                            <!-- RECORDING TAB -->
                            <div class="input-content" id="tab-record">
                                <div class="audio-record-box" style="text-align: center; padding: 2rem;">
                                    <div id="mic-status" style="margin-bottom: 1rem; color: var(--text-muted);">
                                        Ready to record
                                    </div>
                                    <div id="visualizer"
                                        style="height: 40px; display: flex; align-items: center; justify-content: center; gap: 4px; margin-bottom: 1.5rem; display: none;">
                                        <!-- fake visualizer bars -->
                                        <div class="v-bar"
                                            style="width: 4px; height: 10px; background: var(--primary); animation: bounce 1s infinite;">
                                        </div>
                                        <div class="v-bar"
                                            style="width: 4px; height: 15px; background: var(--primary); animation: bounce 1.2s infinite;">
                                        </div>
                                        <div class="v-bar"
                                            style="width: 4px; height: 20px; background: var(--primary); animation: bounce 0.8s infinite;">
                                        </div>
                                        <div class="v-bar"
                                            style="width: 4px; height: 12px; background: var(--primary); animation: bounce 1.1s infinite;">
                                        </div>
                                        <div class="v-bar"
                                            style="width: 4px; height: 18px; background: var(--primary); animation: bounce 0.9s infinite;">
                                        </div>
                                    </div>
                                    <div style="font-size: 2rem; font-weight: 700; font-variant-numeric: tabular-nums; margin-bottom: 1.5rem;"
                                        id="record-timer">00:00</div>

                                    <div class="record-controls">
                                        <button id="start-record-btn" class="btn-clinical"
                                            style="background: var(--danger); border-color: var(--danger);">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                style="margin-right: 0.5rem;">
                                                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z" />
                                                <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                                <line x1="12" y1="19" x2="12" y2="22" />
                                            </svg>
                                            Start Recording
                                        </button>
                                        <button id="stop-record-btn" class="btn-clinical"
                                            style="background: var(--text-muted); border-color: var(--text-muted); display: none;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round"
                                                style="margin-right: 0.5rem;">
                                                <rect x="6" y="6" width="12" height="12" />
                                            </svg>
                                            Stop Recording
                                        </button>
                                    </div>

                                    <div id="recording-result" class="card"
                                        style="display: none; margin-top: 1.5rem; text-align: left; background: var(--bg-main);">
                                        <div
                                            style="display: flex; align-items: center; justify-content: space-between;">
                                            <div>
                                                <span style="font-weight: 600;">New Recording</span>
                                                <div
                                                    style="font-size: 0.8rem; color: var(--text-muted); margin-top: 2px;">
                                                    Ready for analysis</div>
                                            </div>
                                            <button id="upload-recording-btn" class="btn-clinical">Upload &
                                                Analyze</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Processing Overlay -->
                    <div class="col-12" id="processing-status" style="display: none;">
                        <div class="card" style="text-align: center; padding: 4rem 2rem;">
                            <div class="status-indicator" style="width: 40px; height: 40px; margin: 0 auto 1.5rem;">
                            </div>
                            <h3>Analyzing Medical Audio...</h3>
                            <p style="color: var(--text-muted);">AI is transcribing and extracting medical
                                documentation. This usually takes 10-20 seconds.</p>
                        </div>
                    </div>

                    <!-- Results Layout -->
                    <div class="col-8 results-container" id="results-section" style="display: none;">

                        <!-- Summary Section -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path
                                            d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                                        <polyline points="14 2 14 8 20 8" />
                                    </svg>
                                    Clinical Summary
                                </h3>
                                <div id="processing-time" class="tag-badge tag-success">Analysis complete</div>
                            </div>
                            <p id="summary-text" style="line-height: 1.7; color: var(--text-secondary);"></p>
                        </div>

                        <!-- Transcription Section -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
                                    </svg>
                                    Live Transcription
                                </h3>
                            </div>
                            <div class="transcript-bubble-container" id="transcript-container">
                                <!-- Bubbles injected here -->
                            </div>
                        </div>
                    </div>

                    <!-- Sidebar Documentation Column -->
                    <div class="col-4 results-container" id="sidebar-results" style="display: none;">

                        <!-- INSURANCE AUDIT SECTION (NEW) -->
                        <div id="insurance-section" style="display: none;">
                            <div class="card" style="border-left: 5px solid var(--primary);">
                                <div class="card-header" style="border-bottom: none; padding-bottom: 0;">
                                    <h3 class="card-title" style="color: var(--primary); font-weight: 800;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                                        </svg>
                                        Insurance Defender
                                    </h3>
                                </div>
                                <div id="audit-container" style="padding-top: 1rem;">
                                    <!-- Audit cards injected here -->
                                </div>
                            </div>
                        </div>

                        <!-- Documentation Section -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z" />
                                        <path d="M14 2v4a2 2 0 0 0 2 2h4" />
                                        <path d="M10 9H8" />
                                        <path d="M16 13H8" />
                                        <path d="M16 17H8" />
                                    </svg>
                                    Structured Documentation
                                </h3>
                                <div style="display: flex;">
                                    <button class="action-btn" id="btn-whatsapp" title="Send Summary to Patient">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path
                                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.05 12.05 0 0 0 .57 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.03 12.03 0 0 0 2.81.57 2 2 0 0 1 1.72 2.12z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div id="documentation-content">
                                <!-- Sections injected here -->
                            </div>
                        </div>

                        <!-- Real-time Nurse Tasks -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10" />
                                        <polyline points="12 6 12 12 16 14" />
                                    </svg>
                                    Automated Tasks
                                </h3>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span class="tag-badge tag-warning" id="tasks-count">0</span>
                                    <button class="action-btn" id="btn-handover" title="View Shift Handover">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                            <circle cx="9" cy="7" r="4" />
                                            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div id="tasks-grid">
                                <!-- Tasks injected here -->
                            </div>
                        </div>
                    </div>

                    <!-- ERROR MESSAGE -->
                    <div class="col-12" id="error-message" style="display: none;">
                        <div class="card" style="border-color: var(--danger); background: #FEF2F2;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; color: var(--danger);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10" />
                                    <line x1="12" y1="8" x2="12" y2="12" />
                                    <line x1="12" y1="16" x2="12.01" y2="16" />
                                </svg>
                                <span style="font-weight: 700;">Extraction Error:</span>
                                <span id="error-text"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Welcome / Information -->
                    <div class="col-12" id="welcome-section">
                        <div class="card"
                            style="background: var(--primary-soft); border-color: var(--primary); padding: 3rem; text-align: center;">
                            <h2 style="margin-bottom: 1rem; color: var(--primary);">Welcome to MedDoc Dashboard</h2>
                            <p style="color: var(--text-secondary); max-width: 600px; margin: 0 auto 2rem;">
                                Start a consultation by providing a YouTube URL or uploading an audio file.
                                AI will automatically generate medical notes and actionable tasks for the nursing
                                staff.
                            </p>
                            <div style="display: flex; justify-content: center; gap: 3rem;">
                                <div>
                                    <p style="font-size: 2rem; font-weight: 800; color: var(--primary);">70%</p>
                                    <p
                                        style="font-size: 0.8rem; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">
                                        Reduces Documentation Time</p>
                                </div>
                                <div style="width: 1px; background: var(--border);"></div>
                                <div>
                                    <p style="font-size: 2rem; font-weight: 800; color: var(--accent);">0</p>
                                    <p
                                        style="font-size: 0.8rem; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">
                                        Missed Medications</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- SECTION: TASKS (DEDICATED VIEW) -->
            <div id="section-tasks" class="section-content">
                <div class="card">
                    <h2 style="margin-bottom: 2rem;">Nurse Work Queue</h2>
                    <div class="tasks-grid">
                        <!-- Tasks reproduced here for dedicated view -->
                    </div>
                </div>
            </div>

            <!-- SECTION: RECORDS -->
            <div id="section-records" class="section-content">
                <div class="card">
                    <h2 style="margin-bottom: 1rem;">Processed Medical Records</h2>
                    <p style="color: var(--text-muted);">History of consultations processed in this session.</p>
                </div>
            </div>

        </main>
    </div>

    <div class="overlay-backdrop" id="modal-backdrop"></div>
    <div class="whatsapp-preview-modal" id="wa-modal">
        <div class="wa-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M19 19v2H5v-2" />
                <path d="M12 15V3" />
                <path d="m5 10 7 7 7-7" />
            </svg>
            <div style="flex: 1;">
                <p style="font-weight: 700; font-size: 0.95rem;">Patient: <span id="wa-patient-name">Guest</span></p>
                <p style="font-size: 0.75rem; opacity: 0.8;">Translating & Sending...</p>
            </div>
            <button class="action-btn" style="background: transparent; border: none; color: white;"
                onclick="closeWaModal()">✕</button>
        </div>
        <div class="wa-body">
            <div class="wa-message">
                <p id="wa-text-content" style="font-size: 0.9rem; margin-bottom: 0.5rem;">Generating summary...</p>
                <div style="font-size: 0.7rem; color: #94A3B8; text-align: right;">12:45 PM</div>
            </div>
            <div class="wa-message">
                <p style="font-size: 0.8rem; color: #54656F; margin-bottom: 0.5rem;">Voice Note (Translated)</p>
                <div class="wa-voice-note">
                    <div class="wa-play-btn">▶</div>
                    <div style="height: 4px; flex: 1; background: #E2E8F0; border-radius: 2px;"></div>
                    <span style="font-size: 0.75rem; color: #54656F;">0:45</span>
                </div>
            </div>
        </div>
        <div class="wa-footer">
            <button class="btn-whatsapp-send" onclick="simulateSend()">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13" />
                    <polygon points="22 2 15 22 11 13 2 9 22 2" />
                </svg>
                Send via WhatsApp
            </button>
        </div>
    </div>

    <!-- Shift Handover Modal -->
    <div class="whatsapp-preview-modal" id="handover-modal" style="width: 500px; background: white;">
        <div class="wa-header" style="background: var(--bg-side);">
            <div style="flex: 1;">
                <p style="font-weight: 700; font-size: 1rem;">Shift Handover (SBAR)</p>
                <p style="font-size: 0.75rem; opacity: 0.8;">Generated for incoming nurse</p>
            </div>
            <button class="action-btn" style="background: transparent; border: none; color: white;"
                onclick="closeHandoverModal()">✕</button>
        </div>
        <div class="wa-body" style="background: var(--bg-main); padding: 1.5rem; min-height: auto;">
            <div id="sbar-inject" class="sbar-container">
                <!-- SBAR content -->
            </div>
        </div>
        <div class="wa-footer" style="background: white; border-top: 1px solid var(--border);">
            <button class="btn-clinical" onclick="closeHandoverModal()" style="width: 100%;">Acknowledge
                Transfer</button>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>